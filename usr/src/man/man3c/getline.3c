.\"
.\" This file and its contents are supplied under the terms of the
.\" Common Development and Distribution License ("CDDL"), version 1.0.
.\" You may only use this file in accordance with the terms of version
.\" 1.0 of the CDDL.
.\"
.\" A full copy of the text of the CDDL should have accompanied this
.\" source.  A copy of the CDDL is also available via the Internet at
.\" http://www.illumos.org/license/CDDL.
.\"
.\"
.\" Copyright (c) 2013, Joyent, Inc. All rights reserved.
.\" Copyright 2014 Garrett D'Amore <garrett@damore.org>
.\"
.Dd "Apr 24, 2013"
.Dt GETLINE 3C
.Os
.Sh NAME
.Nm getline ,
.Nm getdelim
.Nd read delimited input from streams
.Sh SYNOPSIS
.In stdio.h
.Ft ssize_t
.Fo getline
.Fa "char **restrict ptr"
.Fa "size_t *restrict cap"
.Fa "FILE *restrict stream"
.Fc
.
.Ft ssize_t
.Fo getdelim
.Fa "char **restrict ptr"
.Fa "size_t *restrict cap"
.Fa "int delimiter"
.Fa "FILE *restrict stream"
.Fc
.
.Sh DESCRIPTION
The
.Fn getdelim
function reads bytes from the
.Fa stream
into the the
array pointed to by
.Fa ptr ,
until the
.Fa delimiter
byte or an end-of-file condition is encountered. The
.Fa getline
function is identical in
behaviour, but uses the newline character as the delimiter.  The delimiter
character is included in the string (unless end-of-file was reached first) and
the string is terminated with a null byte.
.Lp
The caller may pass a buffer pre-allocated with
.Xr malloc 3C
as
.Fa *ptr ,
along with the capacity of that buffer as
.Fa *cap .
It is also valid to pass
.Dv NULL
for
.Fa *ptr
and 0 for
.Fa *cap ,
at which point memory
will be allocated automatically.  If the buffer provided is not large enough to
hold the string it will be expanded, as if via
.Xr realloc 3C .
The caller should
.Xr free 3C
the buffer when it is no longer required.
.Sh RETURN VALUES
If successful,
.Fn getdelim
and
.Fn getline
return the number of bytes
written into the buffer, excluding the terminating null byte.  If an error
occurs, or if end-of-file is reached prior to reading any bytes, the value
\(mi1 is returned and
.Va errno
is set to indicate the error.
.Sh EXAMPLES
.Ss Example 1 Read a line from Va stdin
The following example uses
.Fn getline
to read a line from
.Va stdin .
.Bd -literal -offset indent
#include <stdio.h>
\&...
char *ptr = NULL;
size_t cap = 0;

if (getline(&ptr, &cap, stdin) == -1) {
    perror("getline");
    exit(1);
}
fprintf(stdout, "input line: %s", ptr);

free(ptr);
.Ed
.Sh ERRORS
The
.Fn getline
and
.Fn getdelim
functions may fail due to the following errors:
.Bl -tag -width Er
.It Er EINVAL
Either
.Fa ptr
or
.Fa cap are
.Dv NULL , or th
.Fa delimiter
is not a valid character.
.It Er EOVERFLOW
More than
.Dv SSIZE_MAX
characters were read from the stream without
encountering the
.Fa delimiter .
.El
.Lp
The
.Fn getline
and
.Fn getdelim
functions may also fail and set
.Va errno
for any of the errors specified for the library routines
.Xr realloc 3C
or
.Xr fgetc 3C .
.Sh INTERFACE STABILITY
.Sy Standard .
.Sh MT-LEVEL
.Sy MT-Safe .
.Sh SEE ALSO
.Xr fgetc 3C ,
.Xr fgets 3C ,
.Xr free 3C ,
.Xr malloc 3C ,
.Xr realloc 3C ,
.Xr standards 5
.Sh STANDARDS
These functions are available in the following compilation environment. See
.Xr standards 5 .
.Lp
.Bl -bullet -compact
.It
.St -p1003.1-2008 .
.El
