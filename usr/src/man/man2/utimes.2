.\" Copyright 2014 Garrett D'Amore <garrett@damore.org>
.\" Copyright (c) 2009, Sun Microsystems, Inc.  All Rights Reserved.
.\" Portions Copyright (c) 1992, X/Open Company Limited.  All Rights Reserved.
.\" Sun Microsystems, Inc. gratefully acknowledges The Open Group for permission to reproduce portions of its copyrighted documentation. Original documentation from The Open Group can be obtained online at  http://www.opengroup.org/bookstore/.
.\" The Institute of Electrical and Electronics Engineers and The Open Group, have given us permission to reprint portions of their documentation. In the following statement, the phrase "this text" refers to portions of the system documentation. Portions of this text
.\" are reprinted and reproduced in electronic form in the Sun OS Reference Manual, from IEEE Std 1003.1, 2004 Edition, Standard for Information Technology -- Portable Operating System Interface (POSIX), The Open Group Base Specifications Issue 6, Copyright (C) 2001-2004 by the Institute of Electrical
.\" and Electronics Engineers, Inc and The Open Group. In the event of any discrepancy between these versions and the original IEEE and The Open Group Standard, the original IEEE and The Open Group Standard is the referee document. The original Standard can be obtained online at http://www.opengroup.org/unix/online.html.
.\"  This notice shall appear on any product containing this material.
.\" The contents of this file are subject to the terms of the Common Development and Distribution License (the "License").  You may not use this file except in compliance with the License. You can obtain a copy of the license at usr/src/OPENSOLARIS.LICENSE or http://www.opensolaris.org/os/licensing.
.\"  See the License for the specific language governing permissions and limitations under the License. When distributing Covered Code, include this CDDL HEADER in each file and include the License file at usr/src/OPENSOLARIS.LICENSE.  If applicable, add the following below this CDDL HEADER, with
.\" the fields enclosed by brackets "[]" replaced with your own identifying information: Portions Copyright [yyyy] [name of copyright owner]
.Dd Aug 26, 2014
.Dt UTIMES 2
.Os
.Sh NAME
.Nm utimes ,
.Nm futimesat
.Nd set file access and modification times
.Sh SYNOPSIS
.In sys/time.h
.Ft int
.Fn utimes "const char *path" "const struct timeval times[2]"
.
.Ft int
.Fn futimesat "int filedes" "const char *path" "const struct timeval times[2]"
.
.Sh DESCRIPTION
The
.Fn utimes
function sets the access and modification times of the file
pointed to by the
.Fa path
argument to the value of the
.Fa times
argument.
It allows time specifications accurate to the microsecond.
.Lp
The
.Fn futimesat
function also sets access and modification times.  See
.Xr fsattr 5 .
If
.Fa path
is a relative path name, however,
.Fn futimesat
resolves the path relative to the
.Fa fildes
argument rather than the current working directory.  If
.Fa fildes
is set to
.Dv AT_FDCWD ,
defined in
.In fcntl.h ,
.Fn futimesat
resolves the path relative to the current working directory.  If
.Fa path
is a null pointer,
.Fn futimesat
sets the access and modification times on the file referenced
by
.Fa fildes .
The
.Fa fildes
argument is ignored when
.Fn futimesat
is provided with an absolute path.
.Lp
The
.Fa times
argument is an array of
.Vt timeval
structures. The first
array member represents the date and time of last access, and the second member
represents the date and time of last modification.  The times in the
.Vt timeval
structure are measured in seconds and microseconds since the
Epoch, although rounding toward the nearest second may occur.
.Lp
If the
.Vt times
argument is a null pointer, the access and modification
times of the file are set to the current time.  The effective user ID of
the process must be the same as the owner of the file, or must have write
access to the file or the
.Brq Dv PRIV_FILE_OWNER
privilege to use this call in
this manner. Upon completion,
.Fn utimes
will mark the time of the last
file status change,
.Vt st_ctime ,
for update.
.
.Sh RETURN VALUES
.
Upon successful completion, 0 is returned.  Otherwise, \(mi1 is
returned,
.Va errno
is set to indicate the error, and the file times will not be affected.
.
.Sh ERRORS
.
The
.Fn utimes
and
.Fn futimesat
functions will fail if:
.Bl -tag -width Er
.It Bq Er EACCES
Search permission is denied by a component of the path prefix; or the
.Vt times
argument is a null pointer and the effective user ID of the
process does not match the owner of the file and write access is denied.
.
.It Bq Er EFAULT
The
.Fa path
or
.Fa times
argument points to an illegal address. For
.Fn futimesat ,
Fa path
might have the value
.Dv NULL
if the
.Fa fildes
argument refers to a valid open file descriptor.
.
.It Bq Er EINTR
A signal was caught during the execution of the
.Fn utimes
function.
.
.It Bq Er EINVAL
The number of microseconds specified in one or both of the
.Vt timeval
structures pointed to by
.Fa times
was greater than or equal to 1,000,000 or less than 0.
.
.It Bq Er EIO
An I/O error occurred while reading from or writing to the file system.
.
.It Bq Er ELOOP
Too many symbolic links were encountered in resolving
.Fa path .
.
.It Bq Er ENAMETOOLONG
The length of the
.Fa path
argument exceeds
.Brq Dv PATH_MAX
or a pathname component is longer than
.Brq Dv NAME_MAX .
.
.It Bq Er ENOLINK
The
.Fa path
argument points to a remote machine and the link to that machine
is no longer active.
.
.It Bq Er ENOENT
A component of
.Fa path
does not name an existing file or
.Fa path
is an empty string.
.
.It Bq Er ENOTDIR
A component of the path prefix is not a directory or the
.Fa path
argument is relative and the
.Fa fildes
argument is not
.Dv AT_FDCWD
or does not refer to a valid directory.
.
.It Bq Er EPERM
The
.Fa times
argument is not a null pointer and the calling process's
effective user ID has write access to the file but does not match the
owner of the file and the calling process does not have the appropriate
privileges.
.
.It Bq Er EROFS
The file system containing the file is read-only.
.
.El
.Lp
The
.Fn utimes
and
.Fn futimesat
functions may fail if:
.Bl -tag -width Er
.It Bq Er ENAMETOOLONG
Path name resolution of a symbolic link produced an intermediate result whose
length exceeds
.Brq Dv PATH_MAX .
.El
.
.Sh INTERFACE STABILITY
.
The
.Fn utimes
function is
.Sy Standard .
.Lp
The
.Fn futimesat
function is
.Sy Obsolete Committed .
The
.Xr utimensat 2
function is preferred for use in portable applications.
.
.Sh SEE ALSO
.Xr futimens 2 ,
.Xr stat 2 ,
.Xr utime 2 ,
.Xr fsattr 5 ,
.Xr standards 5
.
.Sh STANDARDS
.
These functions are available in the following compilation environments. See
.Xr standards 5 .
.Ss Fn utimes
.Bl -bullet -compact
.It
.St -xpg4.2
.It
.St -susv2
.It
.St -susv3
.It
.St -p1003.1-2008
.El
.Ss Fn futimesat
The
.Fn futimesat
function is a local extension and not available in any standards conforming
environments.
